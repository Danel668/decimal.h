#include <check.h>
#include <float.h>
#include <math.h>
#include <stdio.h>

#include "s21_decimal.h"

static float src[] = {
    0.f,
    1E-28f,
    1.00000003E-27f,
    1.19999996E-27f,
    1.50000004E-27f,
    1.89999999E-27f,
    9.99999989E-27f,
    1.23000001E-26f,
    1.50999995E-26f,
    1.89999999E-26f,
    1.00000002E-25f,
    1.23699997E-25f,
    1.51899999E-25f,
    1.90599999E-25f,
    1.00000002E-24f,
    2.21370009E-24f,
    7.51489961E-24f,
    4.91059997E-24f,
    1E-23f,
    2.21370005E-23f,  // 19

};

static s21_decimal dst[] = {
    {{0x00000000, 0x00000000, 0x00000000, 0x00000000}},  // 0
    {{0x00000001, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000001
    {{0x00000001, 0x00000000, 0x00000000,
      0x001B0000}},  // 0.000000000000000000000000001
    {{0x0000000C, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000012
    {{0x0000000F, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000015
    {{0x00000013, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000019
    {{0x00000001, 0x00000000, 0x00000000,
      0x001A0000}},  // 0.00000000000000000000000001
    {{0x0000007B, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000123
    {{0x00000097, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000000151
    {{0x00000013, 0x00000000, 0x00000000,
      0x001B0000}},  // 0.000000000000000000000000019
    {{0x00000001, 0x00000000, 0x00000000,
      0x00190000}},  // 0.0000000000000000000000001
    {{0x000004D5, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000001237
    {{0x000005EF, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000001519
    {{0x00000772, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000001906
    {{0x00000001, 0x00000000, 0x00000000,
      0x00180000}},  // 0.000000000000000000000001
    {{0x00005679, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000022137
    {{0x0001258D, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000075149
    {{0x0000BFD2, 0x00000000, 0x00000000,
      0x001C0000}},  // 0.0000000000000000000000049106
    {{0x00000001, 0x00000000, 0x00000000,
      0x00170000}},  // 0.00000000000000000000001
    {{0x00005679, 0x00000000, 0x00000000,
      0x001B0000}},  // 0.000000000000000000000022137

};

START_TEST(test) {
  for (size_t i = 0; i < 20; ++i) {
    s21_decimal tmp;
    int ret = s21_from_float_to_decimal(src[i], &tmp);
    ck_assert_int_eq(tmp.bits[0], dst[i].bits[0]);
    ck_assert_int_eq(tmp.bits[1], dst[i].bits[1]);
    ck_assert_int_eq(tmp.bits[2], dst[i].bits[2]);
    ck_assert_int_eq(tmp.bits[3], dst[i].bits[3]);
    ck_assert_int_eq(ret, 0);
  }
}
END_TEST

Suite *suite_from_float_to_decimal(void) {
  Suite *s;
  TCase *tc;

  s = suite_create("s21_from_float_to_decimal");
  tc = tcase_create("s21_from_float_to_decimal");

  if (s != NULL && tc != NULL) {
    tcase_add_test(tc, test);
    suite_add_tcase(s, tc);
  }

  return (s);
}
